version: 3
dotenv:
  - ""

tasks:
  install:
    cmds:
#      - go install ./tools/cmd/protoc-gen-cckey
      - go install ./tools/cmd/protoc-gen-go-hlf
  gen:cmd:
    deps:
      - install
    cmds:
      - buf generate
  gen:all:
    watch: true
    # sources:
    #   - "./lib/proto/rbac/rbac.proto"
    cmds:
      - buf generate

  gen:clean:
    cmds:
      - rm -rf ./lib/go/gen/chaincode
      - rm -rf ./lib/go/gen/*
      - rm -rf ./lib/es/gen/*


  gen-lib:
    vars:
      template: buf-lib-gen.yaml
    cmds:
      - buf generate --template "${template}"

  go:format:
    cmds:
      - golines --ignore-generated  . -w




  fabric:getMetadata:
    cmds:
      - peer chaincode query -C default -n Thesis -c '{"Args":["org.hyperledger.fabric:GetMetadata"]}'


  default:
    watch: true
    sources:
      - "proto/**/*"
      - "tools/**/*"
    cmds:
      - buf generate
